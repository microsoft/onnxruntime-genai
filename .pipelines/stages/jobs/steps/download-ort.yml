parameters:
  genai_src: '$(Build.SourcesDirectory)'
  ort_filename: 'onnxruntime-linux-1.17.1'
  ort_version: '1.17.1'
  archive: 'tgz'
steps:
- task: DownloadGitHubRelease@0
  inputs:
    connection: 'GitHub - Release'
    userRepository: 'microsoft/onnxruntime'
    defaultVersionType: 'specificTag'
    version: 'v${{ parameters.ort_version }}'
    itemPattern: '${{ parameters.ort_filename }}*'
    downloadPath: '${{ parameters.genai_src }}'
  displayName: Download ${{ parameters.ort_filename }}

- task: ExtractFiles@1
  inputs:
    archiveFilePatterns: '**/*.${{ parameters.archive }}'
    destinationFolder: '${{ parameters.genai_src }}'
    cleanDestinationFolder: false
    overwriteExistingFiles: true
  displayName: Unzip OnnxRuntime

- task: CopyFiles@2
  inputs:
    SourceFolder: '${{ parameters.genai_src }}/${{ parameters.ort_filename }}'
    TargetFolder: '${{ parameters.genai_src }}/ort'
  displayName: Copy OnnxRuntime to ort

- task: DeleteFiles@1
  inputs:
    SourceFolder: '${{ parameters.genai_src }}/ort/lib'
    Contents: '*tensorrt*'
    RemoveSourceFolder: false
  displayName: 'Remove tensorrt from lib'
  continueOnError: true