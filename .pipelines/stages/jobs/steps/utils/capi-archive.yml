parameters:
- name: genai_src
  type: string
- name: artifactName
  type: string
- name: ep
  type: string
- name: archiveType
  type: string
- name: buildDir
  type: string
steps:
- task: CopyFiles@2
  displayName: 'Copy Onnxruntime C API library files to ArtifactStagingDirectory'
  inputs:
    SourceFolder: '${{ parameters.genai_src }}/ort/lib'
    TargetFolder: '$(Build.ArtifactStagingDirectory)/${{ parameters.artifactName }}/lib'

- task: CopyFiles@2
  displayName: 'Copy GenAi C API library files to ArtifactStagingDirectory'
  inputs:
    SourceFolder: '${{ parameters.buildDir }}'
    Contents: |
      onnxruntime-genai.so
    TargetFolder: '$(Build.ArtifactStagingDirectory)/${{ parameters.artifactName }}/lib'

- task: CopyFiles@2
  displayName: 'Copy GenAi C API header to ArtifactStagingDirectory'
  inputs:
    SourceFolder: '${{ parameters.genai_src }}/src'
    Contents: |
      ort_genai_c.h
    TargetFolder: '$(Build.ArtifactStagingDirectory)/${{ parameters.artifactName }}/include'

- task: CopyFiles@2
  displayName: 'Copy other files to ArtifactStagingDirectory'
  inputs:
    SourceFolder: '${{ parameters.genai_src }}'
    Contents: |
      VERSION_INFO
      LICENSE
      SECURITY.md
      README.md
      ThirdPartyNotices.txt
    TargetFolder: '$(Build.ArtifactStagingDirectory)/${{ parameters.artifactName }}'

- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: '$(Build.ArtifactStagingDirectory)/${{ parameters.artifactName }}'
    includeRootFolder: true
    archiveType: ${{ parameters.archiveType }}
    ${{ if eq(parameters.archiveType, 'tar') }}:
      tarCompression: 'gz'
    archiveFile: '$(Build.ArtifactStagingDirectory)/${{ parameters.artifactName }}.${{ parameters.archiveType }}'
    replaceExistingArchive: true

- task: DeleteFiles@1
  inputs:
    SourceFolder: '$(Build.ArtifactStagingDirectory)/${{ parameters.artifactName }}'
    Contents: '*'
    RemoveSourceFolder: true