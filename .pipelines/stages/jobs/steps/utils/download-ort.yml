parameters:
- name: genai_src
  type: string
- name: archiveType
  type: string
steps:
- bash: |
    echo "##[error]Error: ort_version and ort_filename are not set"
    exit 1
  displayName: 'Check if variables ort_filename and ort_filename are set'
  condition: or( eq (variables['ort_version'], ''), eq (variables['ort_filename'], ''))

- task: DownloadGitHubRelease@0
  inputs:
    connection: 'GitHub - Release'
    userRepository: 'microsoft/onnxruntime'
    defaultVersionType: 'specificTag'
    version: 'v$(ort_version)'
    itemPattern: '$(ort_filename)*'
    downloadPath: '${{ parameters.genai_src }}'
  displayName: Download $(ort_filename)

- task: ExtractFiles@1
  inputs:
    archiveFilePatterns: '**/*.${{ parameters.archiveType }}'
    destinationFolder: '${{ parameters.genai_src }}'
    cleanDestinationFolder: false
    overwriteExistingFiles: true
  displayName: Unzip OnnxRuntime

- task: CopyFiles@2
  inputs:
    SourceFolder: '${{ parameters.genai_src }}/$(ort_filename)'
    TargetFolder: '${{ parameters.genai_src }}/ort'
  displayName: Copy OnnxRuntime to ort

- task: DeleteFiles@1
  inputs:
    SourceFolder: '${{ parameters.genai_src }}/ort/lib'
    Contents: '*tensorrt*'
    RemoveSourceFolder: false
  displayName: 'Remove tensorrt from lib'
  continueOnError: true